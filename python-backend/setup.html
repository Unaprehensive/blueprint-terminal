<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blueprint Terminal - First-Time Setup</title>
    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #141824;
            --bg-panel: rgba(20, 24, 36, 0.95);
            --accent-primary: #00ffff; /* Cyan */
            --accent-secondary: #ff00ff; /* Magenta */
            --accent-tertiary: #8b5cf6; /* Purple */
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --border: rgba(139, 92, 246, 0.3);
            --shadow-glow: 0 0 25px rgba(0, 255, 255, 0.3);
            --success: #22c55e;
            --warning: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.05;
            background: 
                radial-gradient(circle at 10% 20%, var(--accent-primary) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, var(--accent-secondary) 0%, transparent 40%);
            animation: bgPulse 15s ease-in-out infinite;
        }

        @keyframes bgPulse {
            0%, 100% { opacity: 0.05; transform: scale(1); }
            50% { opacity: 0.1; transform: scale(1.05); }
        }

        .setup-container {
            width: 600px;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 40px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5), var(--shadow-glow);
            animation: fadeIn 1s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
        }

        .logo {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .installation-guide {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 25px;
            margin-top: 20px;
        }
        
        .installation-guide p {
            margin-bottom: 15px;
            line-height: 1.6;
            color: var(--text-secondary);
            text-align: center;
        }
        
        .installation-guide a {
            color: var(--accent-primary);
            text-decoration: none;
            font-weight: bold;
        }
        
        .installation-guide a:hover {
            text-decoration: underline;
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .warning-title {
            color: var(--warning);
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warning-text {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .btn-continue {
            width: 100%;
            padding: 15px;
            margin-top: 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, var(--accent-tertiary), var(--accent-primary));
            color: white;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
        }

        .btn-continue:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 30px rgba(0, 255, 255, 0.5);
        }

        .btn-continue:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .status-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            display: none;
        }

        .status-message.success {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .status-message.warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .platform-info {
            margin-top: 15px;
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="setup-container">
        <div class="header">
            <div class="logo">First-Time Setup</div>
            <div class="subtitle">MetaTrader 5 Required</div>
        </div>

        <div class="warning-box">
            <div class="warning-title">
                ⚠️ Risk Warning
            </div>
            <div class="warning-text">
                Trading CFDs and Forex involves significant risk of loss. Up to 80% of retail investor accounts lose money when trading CFDs. You should consider whether you understand how CFDs work and whether you can afford to take the high risk of losing your money.
            </div>
        </div>
        
        <div class="installation-guide">
            <p>Welcome to Blueprint Terminal. To continue, please install the MetaTrader 5 platform.</p>
            <p><a href="#" onclick="openMT5Download()">Download MetaTrader 5 Official</a></p>
            <p>Once installed, please log in to your account inside the MT5 terminal at least once. Then click the button below.</p>
        </div>

        <button class="btn-continue" id="recheck-btn">I have installed MT5, check again</button>
        
        <div class="status-message" id="status-message"></div>
        
        <div class="platform-info" id="platform-info">
            Platform: <span id="current-platform">Unknown</span> | 
            Version: <span id="app-version">2.1.0</span>
        </div>
    </div>

    <script>
        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            updatePlatformInfo();
        });

        // Обновление информации о платформе
        function updatePlatformInfo() {
            if (window.electronAPI) {
                const platform = window.electronAPI.getPlatform();
                const version = window.electronAPI.getVersion();
                
                document.getElementById('current-platform').textContent = 
                    platform === 'win32' ? 'Windows' : 
                    platform === 'darwin' ? 'macOS' : 
                    platform === 'linux' ? 'Linux' : platform;
                    
                document.getElementById('app-version').textContent = version;
            }
        }

        // Открытие ссылки на скачивание MT5
        function openMT5Download() {
            const platform = window.electronAPI ? window.electronAPI.getPlatform() : 'win32';
            let downloadUrl;
            
            if (platform === 'darwin') {
                downloadUrl = 'https://download.mql5.com/cdn/web/metaquotes.software.corp/mt5/MetaTrader5.dmg';
            } else {
                downloadUrl = 'https://download.mql5.com/cdn/web/metaquotes.software.corp/mt5/mt5setup.exe';
            }
            
            // Открываем ссылку в браузере по умолчанию
            if (window.electronAPI) {
                // Для Electron можно добавить метод openExternal
                window.open(downloadUrl, '_blank');
            } else {
                window.open(downloadUrl, '_blank');
            }
        }

        // Обработчик кнопки проверки
        document.getElementById('recheck-btn').addEventListener('click', async () => {
            const button = document.getElementById('recheck-btn');
            const statusMessage = document.getElementById('status-message');
            
            // Показываем индикатор загрузки
            button.disabled = true;
            button.innerHTML = '<span class="loading-spinner"></span>Checking MT5 installation...';
            
            statusMessage.style.display = 'none';
            
            try {
                if (window.electronAPI) {
                    // Показываем предупреждение о рисках
                    const riskAccepted = await window.electronAPI.showRiskWarning();
                    
                    if (!riskAccepted) {
                        showStatusMessage('You must accept the risk warning to continue.', 'warning');
                        return;
                    }
                    
                    // Сохраняем конфигурацию первого запуска
                    await window.electronAPI.saveUserConfig({
                        firstRun: false,
                        riskWarningAccepted: true,
                        setupDate: new Date().toISOString()
                    });
                    
                    // Запускаем проверку платформ
                    await window.electronAPI.recheckPlatforms();
                    
                    showStatusMessage('Setup completed! Starting terminal...', 'success');
                    
                } else {
                    // Fallback для веб-версии
                    showStatusMessage('Electron API not available', 'warning');
                }
                
            } catch (error) {
                console.error('Setup error:', error);
                showStatusMessage('Error during setup: ' + error.message, 'warning');
            } finally {
                // Восстанавливаем кнопку
                setTimeout(() => {
                    button.disabled = false;
                    button.textContent = 'I have installed MT5, check again';
                }, 2000);
            }
        });

        // Показ статусного сообщения
        function showStatusMessage(message, type = 'success') {
            const statusMessage = document.getElementById('status-message');
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
            
            // Автоматически скрываем сообщение через 5 секунд
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 5000);
        }

        // Обработка событий от главного процесса
        if (window.electronAPI) {
            window.electronAPI.onPlatformCheckResult((event, result) => {
                if (result.success) {
                    showStatusMessage('MT5 found! Loading terminal...', 'success');
                } else {
                    showStatusMessage(result.message || 'MT5 not found. Please install it first.', 'warning');
                }
            });
        }
    </script>
</body>
</html>